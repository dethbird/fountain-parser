(function(){"use strict";function d(i){const c=i.split(`
`),l=[];let t={character_extended:!1,note:!1};for(let a=0;a<c.length;a++){const r=c[a],e=r.trim();if(!e){t.character_extended=!1,l.push({id:`line-${a}`,text:r,index:a,type:"blank",className:"blank-line",speaker:null});continue}let s="action",n="action",o=null;if(t.note)e.includes("]]")&&(t.note=!1),s="note",n="note";else if(e.includes("[["))t.note=!e.includes("]]"),s="note",n="note";else if(/^(INT\.|EXT\.|EST\.|I\/E\.|\.)/i.test(e))t.character_extended=!1,s="scene",n="scene-heading";else if(/^(FADE IN:|FADE OUT\.|CUT TO:|DISSOLVE TO:|SMASH CUT TO:)/.test(e)||/TO:$/.test(e))t.character_extended=!1,s="transition",n="transition";else if(/^[A-Z][A-Z\s]*$/.test(e)&&e.length<50&&e.length>1&&!e.includes(".")&&!e.includes(",")&&!e.includes("!")&&!e.includes("?"))t.character_extended=!0,s="character",n="character",o=e;else if(t.character_extended)/^\(.*\)$/.test(e)?(s="parenthetical",n="parenthetical"):(s="dialogue",n="dialogue");else if(/^= /.test(e))t.character_extended=!1,s="synopsis",n="synopsis";else if(/^#{1,4}\s/.test(e)){t.character_extended=!1;const f=e.match(/^(#{1,4})/)[1].length;s="section",n=`section-${f}`}else/^={3,}$/.test(e)?(t.character_extended=!1,s="page_break",n="page-break"):(t.character_extended=!1,s="action",n="action");l.push({id:`line-${a}`,text:r,index:a,type:s,className:n,speaker:o})}return console.log("Final blocks:",l.map(a=>`${a.index}: "${a.text.trim()}" -> ${a.type}`)),l}self.onmessage=function(i){const{type:c,text:l}=i.data;if(c==="process"){const t=d(l);self.postMessage({type:"result",blocks:t})}}})();
