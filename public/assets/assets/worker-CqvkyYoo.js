(function(){"use strict";function u(d){const r=d.split(`
`),l=[];let s={character_extended:!1,note:!1};for(let i=0;i<r.length;i++){const c=r[i],e=c.trim();if(!e){s.character_extended=!1,l.push({id:`line-${i}`,text:c,index:i,type:"blank",className:"blank-line",speaker:null});continue}let t="action",a="action",f=null;if(s.note)e.includes("]]")&&(s.note=!1),t="note",a="note";else if(e.includes("[["))s.note=!e.includes("]]"),t="note",a="note";else if(/^(INT\.|EXT\.|EST\.|I\/E\.|\.)/i.test(e))s.character_extended=!1,t="scene",a="scene-heading";else if(/^(FADE IN:|FADE OUT\.|CUT TO:|DISSOLVE TO:|SMASH CUT TO:)/.test(e)||/TO:$/.test(e))s.character_extended=!1,t="transition",a="transition";else if(/^[A-Z][A-Z\s]*(\^)?$/.test(e)&&e.replace("^","").length<50&&e.length>1&&!e.includes(".")&&!e.includes(",")&&!e.includes("!")&&!e.includes("?"))s.character_extended=!0,t="character",a="character",f=e;else if(s.character_extended)/^\(.*\)$/.test(e)?(t="parenthetical",a="parenthetical"):(t="dialogue",a="dialogue");else if(/^= /.test(e))s.character_extended=!1,t="synopsis",a="synopsis";else if(/^~ /.test(e))s.character_extended=!1,t="lyrics",a="lyrics";else if(/^- /.test(e))s.character_extended=!1,t="milestone",a="milestone";else if(/^\d{1,2}:\d{2}$/.test(e))s.character_extended=!1,t="duration",a="duration";else if(/^\[i\]https?:\/\/.+/i.test(e))s.character_extended=!1,t="image",a="image";else if(/^\[a\]https?:\/\/.+/i.test(e))s.character_extended=!1,t="audio",a="audio";else if(/^(title|credit|author[s]?|source|notes|draft date|date|contact|copyright):/i.test(e)){s.character_extended=!1;const n=e.match(/^(title|credit|author[s]?|source|notes|draft date|date|contact|copyright):/i);n&&(n[1].toLowerCase()==="title"?(t="title",a="title-page-title"):(t="title_page",a="title-page-element"))}else if(/^#{1,4}\s/.test(e)){s.character_extended=!1;const n=e.match(/^(#{1,4})/)[1].length;t="section",a=`section-${n}`}else/^={3,}$/.test(e)?(s.character_extended=!1,t="page_break",a="page-break"):(s.character_extended=!1,t="action",a="action");let o=c;t==="title"?o=c.replace(/^title:\s*/i,""):t==="image"?o=`<img src="${c.replace(/^\[i\]/i,"")}" alt="Storyboard image" style="max-width: 100%; height: auto; border: 1px solid #ccc; margin: 0.5em 0;" />`:t==="audio"&&(o=`<audio controls style="width: 100%; margin: 0.5em 0;"><source src="${c.replace(/^\[a\]/i,"")}" type="audio/mpeg">Your browser does not support the audio element.</audio>`),l.push({id:`line-${i}`,text:o,index:i,type:t,className:a,speaker:f})}return console.log("Final blocks:",l.map(i=>`${i.index}: "${i.text.trim()}" -> ${i.type}`)),l}self.onmessage=function(d){const{type:r,text:l}=d.data;if(r==="process"){const s=u(l);self.postMessage({type:"result",blocks:s})}}})();
